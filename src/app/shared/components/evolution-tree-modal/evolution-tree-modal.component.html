<app-modal [id]="id()" (openEvent)="onOpen()" (closeEvent)="onClose()">
  <div class="evolution-tree-container">
    <div class="evolution-tree-header">
      <h2>{{ mainDigimon()?.name }}</h2>
    </div>
    <div class="evolution-tree-content">
      <div class="evolution-tree-graph-container">
        <div id="evolutionTreeWrapper"></div>
      </div>
      <div class="selected-digimon-container">
        <div class="selected-digimon-header">
          <div class="selected-digimon-image">
            @if(selectedDigimon()) {
            <img
              [src]="selectedDigimon()?.img"
              alt="selected-digimon"
              [class]="selectedDigimon()?.rank?.toLowerCase()"
            />
            } @else {
            <span class="placeholder">{{
              "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.SELECT_DIGIMON_PLACEHOLDER"
                | transloco
            }}</span>
            }
          </div>
          <h2>{{ selectedDigimon()?.name }}</h2>
        </div>
        <div class="selected-digimon-content">
          <div class="selected-digimon-info">
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.RANK" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.rank ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.SPECIES" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.species ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.HP" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.hp ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.MP" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.mp ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.ATK" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.atk ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.DEF" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.def ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.SPD" | transloco
              }}:</span>
              <span class="value">{{ selectedDigimon()?.speed ?? "-" }}</span>
            </div>
            <div class="selected-digimon-info-item">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.BITS_PER_MINUTE"
                  | transloco
              }}:</span>
              <span class="value">{{
                selectedDigimon()?.bitFarmingRate ?? "-"
              }}</span>
            </div>
            <div class="selected-digimon-info-requirements">
              <span class="label">{{
                "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.EVOLUTION_REQUIREMENTS"
                  | transloco
              }}</span>
              <div class="requirements-list">
                @for (requirement of selectedDigimon()?.evolutionRequirements;
                track $index) {
                <span>{{ requirement.type }}: {{ requirement.value }}</span>
                }
              </div>
            </div>
          </div>
          @if(selectedDigimon() && canEvolve()) {
          <app-button
            [text]="
              'SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.EVOLVE_INTO'
                | transloco
                  : { main: mainDigimon()?.name, target: selectedDigimon()?.name }
            "
            (onClick)="showEvolutionConfirmationModal()"
          />
          }
        </div>
      </div>
    </div>
  </div>
</app-modal>

<app-modal id="evolution-confirmation-modal" [isUnique]="true">
  <div class="evolution-confirmation-modal-container">
    <div class="evolution-confirmation-container">
      <div class="evolution-confirmation-header">
        <h2>
          {{
            "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.EVOLUTION_CONFIRMATION_TITLE"
              | transloco
          }}
        </h2>
        <span>
          {{
            "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.EVOLUTION_CONFIRMATION_TEXT"
              | transloco
                : { main: mainDigimon()?.name, target: selectedDigimon()?.name }
          }}
        </span>
        <div class="evolution-confirmation-digimon">
          <div class="evolution-confirmation-digimon-main">
            <img [src]="mainDigimon()?.img" alt="main-digimon" />
          </div>
          <i class="ph-arrow-fat-lines-right ph-bold arrow-icon"></i>
          <div class="evolution-confirmation-digimon-selected">
            <img [src]="selectedDigimon()?.img" alt="selected-digimon" />
          </div>
        </div>
      </div>
      <div class="evolution-confirmation-content">
        <div class="evolution-confirmation-content-info">
          @if(mainDigimon() && selectedDigimon()) {

          <span>
            {{ "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.HP" | transloco }}:
            {{ mainDigimon()?.maxHp }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.maxHp }} ↑</span
            >
          </span>
          <span>
            {{ "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.MP" | transloco }}:
            {{ mainDigimon()?.maxMp }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.maxMp }} ↑</span
            >
          </span>
          <span>
            {{ "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.ATK" | transloco }}:
            {{ mainDigimon()?.atk }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.atk }} ↑</span
            >
          </span>
          <span>
            {{ "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.DEF" | transloco }}:
            {{ mainDigimon()?.def }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.def }} ↑</span
            >
          </span>
          <span>
            {{ "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.SPD" | transloco }}:
            {{ mainDigimon()?.speed }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.speed }} ↑</span
            >
          </span>
          <span>
            {{
              "SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.BIT_GENERATION"
                | transloco
            }}: {{ mainDigimon()?.bitFarmingRate }} ->
            <span class="new-value"
              >{{ selectedPossibleEvolutionStats()?.bitFarmingRate }} ↑</span
            >
          </span>
          }
        </div>
        <div class="evolution-confirmation-content-actions">
          <app-button
            [text]="'SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.NO' | transloco"
            [disabled]="isEvolving()"
            (onClick)="this.modalService.close('evolution-confirmation-modal')"
          />
          <app-button
            [text]="'SHARED.COMPONENTS.EVOLUTION_TREE_MODAL.YES' | transloco"
            (onClick)="evolveDigimon()"
            [disabled]="isEvolving()"
          />
        </div>
      </div>
    </div>
  </div>
</app-modal>
